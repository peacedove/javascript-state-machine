!function(){function t(t){return t.charAt(0).toUpperCase()+t.slice(1)}var e={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,n){var r="string"==typeof t.initial?{state:t.initial}:t.initial,i=t.terminal||t["final"],a=n||t.target||{},o=t.events||[],u=t.callbacks||{},c={},s={},f=function(t){var n=t.from instanceof Array?t.from:t.from?[t.from]:[e.WILDCARD];c[t.name]=c[t.name]||{};for(var r=0;r<n.length;r++)s[n[r]]=s[n[r]]||[],s[n[r]].push(t.name),c[t.name][n[r]]=t.to||n[r]};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<o.length;l++)f(o[l]);for(var v in c)c.hasOwnProperty(v)&&(a[v]=e.buildEvent(v,c[v]));for(var v in u)u.hasOwnProperty(v)&&(a[v]=u[v]);return a.current="none",a.is=function(t){return t instanceof Array?t.indexOf(this.current)>=0:this.current===t},a.can=function(t){return!this.transition&&(c[t].hasOwnProperty(this.current)||c[t].hasOwnProperty(e.WILDCARD))},a.cannot=function(t){return!this.can(t)},a.transitions=function(){return s[this.current]},a.isFinished=function(){return this.is(i)},a.error=t.error||function(t,e,n,r,i,a,o){throw o||a},r&&!r.defer&&a[r.event](),a},doCallback:function(t,n,r,i,a,o){if(n)try{return n.apply(t,[r,i,a].concat(o))}catch(u){return t.error(r,i,a,o,e.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",u)}},beforeAnyEvent:function(t,n,r,i,a){return e.doCallback(t,t.onbeforeevent,n,r,i,a)},afterAnyEvent:function(t,n,r,i,a){return e.doCallback(t,t.onafterevent||t.onevent,n,r,i,a)},leaveAnyState:function(t,n,r,i,a){return e.doCallback(t,t.onleavestate,n,r,i,a)},enterAnyState:function(t,n,r,i,a){return e.doCallback(t,t.onenterstate||t.onstate,n,r,i,a)},changeState:function(t,n,r,i,a){return e.doCallback(t,t.onchangestate,n,r,i,a)},beforeThisEvent:function(n,r,i,a,o){return e.doCallback(n,n["onbefore"+t(r)],r,i,a,o)},afterThisEvent:function(n,r,i,a,o){return e.doCallback(n,n["onafter"+t(r)]||n["on"+t(r)],r,i,a,o)},leaveThisState:function(n,r,i,a,o){return e.doCallback(n,n["onleave"+t(i)],r,i,a,o)},enterThisState:function(n,r,i,a,o){return e.doCallback(n,n["onenter"+t(a)]||n["on"+t(a)],r,i,a,o)},beforeEvent:function(t,n,r,i,a){return!1===e.beforeThisEvent(t,n,r,i,a)||!1===e.beforeAnyEvent(t,n,r,i,a)?!1:void 0},afterEvent:function(t,n,r,i,a){e.afterThisEvent(t,n,r,i,a),e.afterAnyEvent(t,n,r,i,a)},leaveState:function(t,n,r,i,a){var o=e.leaveThisState(t,n,r,i,a),u=e.leaveAnyState(t,n,r,i,a);return!1===o||!1===u?!1:e.ASYNC===o||e.ASYNC===u?e.ASYNC:void 0},enterState:function(t,n,r,i,a){e.enterThisState(t,n,r,i,a),e.enterAnyState(t,n,r,i,a)},buildEvent:function(t,n){return function(){var r=this.current,i=n[r]||n[e.WILDCARD]||r,a=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,r,i,a,e.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,r,i,a,e.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===e.beforeEvent(this,t,r,i,a))return e.Result.CANCELLED;if(r===i)return e.afterEvent(this,t,r,i,a),e.Result.NOTRANSITION;var o=this;this.transition=function(){return o.transition=null,o.current=i,e.enterState(o,t,r,i,a),e.changeState(o,t,r,i,a),e.afterEvent(o,t,r,i,a),e.Result.SUCCEEDED},this.transition.cancel=function(){o.transition=null,e.afterEvent(o,t,r,i,a)};var u=e.leaveState(this,t,r,i,a);return!1===u?(this.transition=null,e.Result.CANCELLED):e.ASYNC===u?e.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.StateMachine=e):"function"==typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof window?window.StateMachine=e:"undefined"!=typeof self&&(self.StateMachine=e)}();
